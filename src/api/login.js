import axios from 'axios'
import qs from 'qs'
import { PREFIX_URL, UAID } from './config'
import { getSign } from 'common/js/util'

export function sendVerify(phone) {
  const url = `${PREFIX_URL}/send_verify`
  let data = {
    phone: phone,
    uaid: UAID
  }
  return axios.post(url, qs.stringify(Object.assign({ sign: getSign(data) }, data))).then(function(res) {
    return Promise.resolve(res)
  })
}
export function login(phone, password) {
  const url = `${PREFIX_URL}/login`
  let data = {
    phone: phone,
    password: password,
    uaid: UAID
  }
  return axios.post(url, qs.stringify(Object.assign({ sign: getSign(data) }, data)))
    .then(function(res) {
      return Promise.resolve(res)
    })
    .catch(function(error) {
      if (error.response) {
        // console.log(error.response.data)
        console.log(error.response.status)
        // console.log(error.response.headers)
        return Promise.resolve({
          data: {
            err_code: error.response.status,
            err_msg: error.response.status
          }
        })
      } else {
        return Promise.resolve({
          data: {
            err_code: -1,
            err_msg: -1
          }
        })
      }
    })
}
export function register(phone, password, repassword, code) {
  const url = `${PREFIX_URL}/register`
  let data = {
    phone: phone,
    password: password,
    re_password: repassword,
    code: code,
    uaid: UAID
  }
  return axios.post(url, qs.stringify(Object.assign({ sign: getSign(data) }, data)))
    .then(function(res) {
      return Promise.resolve(res)
    })
    .catch(function(error) {
      if (error.response) {
        // console.log(error.response.data)
        console.log(error.response.status)
        // console.log(error.response.headers)
        return Promise.resolve({
          data: {
            err_code: error.response.status,
            err_msg: error.response.status
          }
        })
      } else {
        return Promise.resolve({
          data: {
            err_code: -1,
            err_msg: -1
          }
        })
      }
    })
}
export function findPassword(phone, password, repassword, code) {
  const url = `${PREFIX_URL}/find_password`
  let data = {
    phone: phone,
    new_password: password,
    re_new_password: repassword,
    code: code,
    uaid: UAID
  }
  return axios.post(url, qs.stringify(Object.assign({ sign: getSign(data) }, data)))
    .then(function(res) {
      return Promise.resolve(res)
    })
    .catch(function(error) {
      if (error.response) {
        // console.log(error.response.data)
        console.log(error.response.status)
        // console.log(error.response.headers)
        return Promise.resolve({
          data: {
            err_code: error.response.status,
            err_msg: error.response.status
          }
        })
      } else {
        return Promise.resolve({
          data: {
            err_code: -1,
            err_msg: -1
          }
        })
      }
    })
}
export function updatePassword(password, newpassword, renewpassword, token) {
  const url = `${PREFIX_URL}/update_password`
  let data = {
    password: password,
    new_password: newpassword,
    re_new_password: renewpassword,
    token: token
  }
  return axios.post(url, qs.stringify(Object.assign({ sign: getSign(data) }, data)))
    .then(function(res) {
      return Promise.resolve(res)
    })
    .catch(function(error) {
      if (error.response) {
        // console.log(error.response.data)
        console.log(error.response.status)
        // console.log(error.response.headers)
        return Promise.resolve({
          data: {
            err_code: error.response.status,
            err_msg: error.response.status
          }
        })
      } else {
        return Promise.resolve({
          data: {
            err_code: -1,
            err_msg: -1
          }
        })
      }
    })
}
